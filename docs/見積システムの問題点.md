## 見積りシステムの問題点

### 🔴 最重要課題: Excel依存による非効率

#### フェーズ2の問題: Excelを開かないと進捗更新できない
- **発注日・入荷日の更新が煩雑**
  - 案件ごとにExcelファイルを開く必要がある
  - 複数案件の進捗を確認するには複数ファイルを開く手間
  - リアルタイムな進捗把握ができない
  - 営業事務の日常業務で最も手間がかかる作業

#### フェーズ3の問題: 計上処理での二重チェック・二重入力
- **指図書→Excel確認→一覧作成→回覧の多段階プロセス**
  1. 営業から指図書で計上指示を受ける
  2. 営業事務が指図書の案件を1件ずつExcelで確認
  3. 計上OK案件の数字を手作業で一覧にまとめる
  4. 一覧を営業担当に回覧して数字が合っているか確認
  5. 確認後、同じ数字を販売管理システムに手入力
  6. さらに同じ数字をノーツに手入力
  
- **二重入力・二重チェックによる時間の無駄**
  - 見積システム → 一覧作成(Excel) → 販売システム → ノーツ
  - 同じデータを4回扱う
  - 各段階で転記ミスのリスク
  - 数字の整合性チェックに時間がかかる

### データ連携の不完全性
- **見積りシステムとノーツ管理の分離**
  - 見積りシステムは「受注」と「何月計上予定」までしか管理できない
  - 計上遅延や実際の計上確定はノーツで別途管理が必要
  - 計上OKフラグがシステム内に存在しない

### 一覧機能の欠如
- **Excel一覧出力機能がない**
  - 見積りDBを直接一覧表示できない
  - 個別リンクで1件ずつ確認する必要がある
  - 月次売上計上リストを手動作成

### 販売システムとの連携課題
- **エクスポート/インポート機能の不足**
  - 案件の仕入れメモを手動で販売システムに入力
  - 受注案内メールが不安定（届いたり届かなかったり）
  - 自動連携は保守システムのみ

### 業務フロー上の問題
- **営業別フォルダ管理の複雑さ**
  - 売上計上関連フォルダを月ごと・営業別に手動作成
  - 見積書リンク、フラグ管理、印刷物の回覧など多段階プロセス
  - ダブルチェック体制(営業事務と営業担当)

### 計上指示の分断
- **指図書による紙ベースの計上指示**
  - 営業担当が計上してほしい案件を「指図書」で営業事務に提出
  - 指図書はシステムと完全に分断されている
  - 営業からの指示がなければ計上処理ができない

---

## システム統合設計プラン

### 現状の業務フロー構造

#### 1. 見積作成フェーズ
```
【鏡(メイン情報 / ヘッダ情報)】
├─ 部門
├─ 担当者
├─ 発行日
├─ 顧客情報
├─ 案件名
├─ 案件カテゴリ
├─ 合計金額
└─ 明細参照 → Excelシート

【承認フロー】
└─ 上長承認 → 最終承認 → PDF作成

【受注時の自動処理】
└─ Excelマクロで明細データをメール通知
```

#### 2. 明細管理フェーズ(Excelシート)
```
【明細情報(1行 = 1商品)】
├─ 商品情報
│  ├─ 品名(例: Windows Server 2025)
│  ├─ 数量
│  └─ 提供単価 → 提供金額
│
├─ 仕入情報
│  ├─ 仕入先名
│  ├─ 仕入単価 → 仕入金額
│  ├─ 粗利金額(提供 - 仕入)
│  └─ 発注日(仕入れがある場合)
│
└─ 進捗管理
   ├─ 入荷チェック + 入荷日
   └─ 出荷可能日
```

#### 3. 月末計上フェーズ(現状の問題箇所)
```
【現状の計上判断プロセス】
営業担当(口頭指示)
 ↓
営業事務(明細確認)
 ↓
手動でExcelに計上予定月入力
 ↓
販売管理システムへ手入力
 ↓
ノーツへ手入力
```

**根本問題**: 見積システムに「計上OKフラグ」が存在しないため、エクスポート→インポートができない

---

### システム統合の設計方針

#### Phase 1: 見積システムの機能拡張(必須基盤)

##### 1-1. 計上管理機能の追加
```
【見積システムに追加する項目】
案件単位:
├─ 計上ステータス
│  ├─ 未計上
│  ├─ 計上申請中
│  ├─ 計上承認済
│  └─ 計上完了
│
├─ 計上予定年月
├─ 計上承認者
├─ 計上承認日時
└─ 計上メモ

明細単位:
├─ 出荷可能フラグ
├─ 計上可能フラグ(明細が揃っているか)
└─ 実計上年月
```

##### 1-2. 一覧・エクスポート機能の追加
```
【必要な一覧画面】
1. 月次計上予定一覧
   - 絞り込み: 営業担当、計上予定月、ステータス
   - 表示項目: 案件名、顧客名、金額、仕入金額、粗利、ステータス
   - 操作: 一括承認、Excel/CSVエクスポート

2. 明細進捗一覧
   - 明細単位での入荷状況・出荷可能日確認
   - 案件別の明細完了率表示

3. 営業担当別ダッシュボード
   - 今月計上予定案件と金額(自動集計)
   - 計上承認待ち案件
   - 入荷待ち案件
```

##### 1-3. データエクスポート仕様
```
【販売管理システム連携用CSV】
必須項目:
- 案件番号
- 顧客コード
- 明細(品名、数量、単価、金額)
- 仕入先情報
- 計上年月
- 計上承認フラグ

【ノーツ連携用CSV】
必須項目:
- 案件番号
- 計上予定月
- 計上確定月
- 売上金額
- 仕入金額
- 営業担当
```

#### Phase 2: 業務フローの再設計

##### 2-1. 計上承認ワークフロー
```
【新しい計上プロセス】

Step1: 明細完了チェック(自動)
└─ 全明細の「入荷済」「出荷可能日設定」をシステムが自動判定

Step2: 営業担当が計上申請
└─ システム上で「計上申請」ボタンをクリック
   (条件: 全明細が計上可能な状態)

Step3: 営業事務が一覧で確認・承認
└─ 「月次計上予定一覧」で一括チェック
└─ 問題なければ「一括承認」

Step4: 自動エクスポート
└─ 承認済み案件を自動でCSV出力
└─ 販売管理システム、ノーツへインポート
```

##### 2-2. 営業担当の確認機能
```
【営業ダッシュボード】
今月計上予定:
├─ 計上承認済: XX件 / XX百万円
├─ 計上申請中: XX件 / XX百万円
├─ 申請可能: XX件 / XX百万円(緑色)
└─ 明細未完了: XX件 / XX百万円(黄色)

詳細確認:
└─ 各案件の明細進捗状況
   └─ 入荷待ち明細の一覧
   └─ 出荷可能日未設定の明細
```

#### Phase 3: システム統合の実装順序

##### 優先度1(即効性・必須)
1. **計上ステータス項目の追加**
2. **月次計上予定一覧画面**
3. **CSV/Excelエクスポート機能**

##### 優先度2(業務効率化)
4. **営業ダッシュボード**
5. **計上申請・承認ワークフロー**
6. **明細進捗一覧**

##### 優先度3(自動化・高度化)
7. **販売管理システムへの自動インポート連携**
8. **ノーツ連携API**
9. **計上可否の自動判定ロジック**

---

### 期待される効果

#### 業務時間削減
- 手動入力作業: 月末2-3日 → 30分
- 案件確認作業: 個別リンククリック → 一覧で一括確認
- 集計作業: Excel手動集計 → 自動集計

#### データ品質向上
- 転記ミスの防止
- リアルタイムな進捗把握
- 計上漏れ・二重計上の防止

#### 営業の可視化
- 今月計上予定額をリアルタイム把握
- 案件の進捗ボトルネックを即座に発見
- 営業事務への問い合わせ削減

---

### 実装にあたっての検討事項

#### 技術面
- [ ] 見積システムの開発環境・技術スタック確認
- [ ] DB設計(テーブル追加・カラム追加)
- [ ] 販売管理システムのインポート仕様確認
- [ ] ノーツのデータ連携方法(API有無)

#### 業務面
- [ ] 指図書の業務フローをシステム化(計上申請機能)
- [ ] 入荷情報の都度入力をシステム内で完結
- [ ] 営業担当への操作トレーニング計画

#### 段階的リリース
- Phase1(3ヶ月): 基本機能(一覧・エクスポート)
- Phase2(6ヶ月): ワークフロー・ダッシュボード
- Phase3(12ヶ月): 完全自動連携

---

## 業務フロー詳細設計

### 【As-Is】現状の業務フロー(詳細版)

#### フェーズ1: 見積作成〜受注
```
[営業担当]
1. 顧客からの引き合い受領
2. 見積システムで鏡(案件情報)作成
   【ヘッダ情報の入力】
   - 部門
   - 担当者
   - 発行日
   - 顧客名
   - 案件名
   - 案件カテゴリ
3. Excel明細シートで商品明細作成
   ├─ 品名、数量、単価を手入力
   ├─ 仕入先情報を手入力
   ├─ 提供金額・仕入金額・粗利を計算(Excel関数)
   └─ 仕入れがある明細には発注日を管理
4. 見積内容が固まったら上長への承認を依頼
   ⭐ 承認フロー: 段階的な承認プロセスが存在
5. 最終承認が完了したらPDFを作成
6. 顧客へ見積書を送付
   
[顧客]
7. 発注判断

[営業担当]
8. 受注確定したら見積システムで「受注」フラグをON
9. Excelマクロが自動実行され、明細データをもとにメールで案内
   ⭐ 自動化: 受注時にマクロで関係者にメール通知
10. 計上予定月を入力(例: 2025年11月)
```

#### フェーズ2: 発注〜入荷管理
```
[営業事務]
11. 受注案件の明細を確認
12. 仕入れが必要な明細を特定
13. 明細の「仕入先」情報をもとに発注書を作成
    ※ 問題: 見積システムから仕入情報をエクスポートできない
    ※ 現状: Excel明細を見ながら手動で販売システムに入力
14. 発注書を仕入先に送付
15. 発注した明細に「発注日」を手入力(Excel明細で管理)

[仕入先]
16. 商品を手配・出荷

[営業事務]
17. 商品入荷の都度、Excelの明細を更新:
    ├─ 入荷チェック(✓)
    ├─ 入荷日(例: 2025/10/25)
    └─ 出荷可能日(例: 2025/10/28)
    ⭐ 重要: この作業は都度行われている(遅延なし)
```

#### フェーズ3: 月末計上処理(最大の問題箇所)
```
[営業担当] ※ 月末25日頃〜月初3日頃
18. 今月計上したい案件を頭の中で整理
    ※ 問題: システムで一覧確認できない
    ※ 現状: 個別に案件リンクをクリックして1件ずつ確認
19. 計上してほしい案件を「指図書」に記入して営業事務に提出
    - 紙またはPDFで案件リストを渡す
    ※ 問題: 指図書はシステムと完全に分断されている
    ※ 問題: 営業からの指図書がないと営業事務は計上処理ができない

[営業事務]
20. 営業担当から受け取った「指図書」をもとに、該当案件を確認
21. 指図書に記載された案件を1件ずつExcelファイルを開いて明細確認
    - 全明細の入荷が完了しているか
    - 出荷可能日が設定されているか
    ※ 問題: 複数案件を確認するために何度もExcelを開く手間
22. 計上OK案件の数字(売上・仕入・粗利)を手作業で一覧にまとめる
    ※ 問題: Excelから数字を転記する作業(二重入力の開始)
23. まとめた一覧を営業担当に回覧して数字が合っているか確認依頼
    ※ 問題: 営業担当による数字の再確認作業(二重チェック)
24. 営業担当の確認後、問題なければ次のステップへ
25. 問題があれば修正して再確認

[営業事務] ※ 月末締め日(通常30日または31日)
26. 確認済み一覧をもとに月次売上計上リストを作成
27. 販売管理システムに売上データを手入力
    ※ 問題: 一覧から販売システムへの転記(二重入力)
28. ノーツに計上情報を手入力
    ※ 問題: 同じ数字をノーツにも転記(三重入力)
29. 各システムの数字が合っているか整合性チェック
    ※ 問題: 手入力のため転記ミスのリスク、チェックに時間
30. ダブルチェック用に印刷物を回覧

[営業担当]
31. 回覧された印刷物を最終確認・承認
32. 問題があれば営業事務に差し戻し
    ※ 問題: 指図書を出した後の確認なので、齟齬があると手戻り発生
```

#### フェーズ4: 計上遅延・修正対応
```
[営業事務] ※ 翌月判明することもある
33. 計上予定だった案件が遅延した場合:
    ├─ ノーツで遅延理由を記録
    ├─ 次月計上に繰り延べ
    └─ 営業担当に状況確認
34. 販売管理システムとノーツの整合性を手動チェック
```

---

### 現状業務の問題点まとめ

#### フェーズ2(発注〜入荷管理)の課題
| 問題 | 影響 | 頻度 |
|------|------|------|
| Excelファイルを都度開く必要 | 進捗確認に時間がかかる | 毎日複数回 |
| 発注日・入荷日の更新が煩雑 | リアルタイム把握ができない | 入荷の都度 |
| 複数案件の横断確認が困難 | 全体の進捗が見えない | 毎日 |

#### フェーズ3(計上処理)の課題
| ステップ | 問題 | 時間 |
|---------|------|------|
| 1. 指図書受領 | システムと分断 | - |
| 2. Excel確認 | 1件ずつファイルを開く | 案件数×3分 |
| 3. 一覧作成 | 手作業で数字転記(1回目) | 30-60分 |
| 4. 営業へ回覧 | 数字の再確認(二重チェック) | 30分 |
| 5. 販売システム入力 | 手入力で数字転記(2回目) | 60-90分 |
| 6. ノーツ入力 | 手入力で数字転記(3回目) | 30-60分 |
| 7. 整合性チェック | 3システムの数字突合 | 30分 |
| **合計** | **同じ数字を4回扱う** | **4-6時間** |

#### 根本原因
- **データの一元管理ができていない**
  - 見積システム、Excel、販売システム、ノーツがバラバラ
  - データを「見る」「まとめる」「転記する」「チェックする」を繰り返す
  
- **一覧機能・エクスポート機能の欠如**
  - システムから直接データを取り出せない
  - 人間が中間作業者となってデータを運ぶ必要がある

---

### 【To-Be】理想の業務フロー(システム化後)

#### フェーズ1: 見積作成〜受注(変更なし)
```
[営業担当]
1-8. (As-Isと同じ)
```

#### フェーズ2: 発注〜入荷管理(半自動化)
```
[営業事務]
9. 受注案件一覧から「発注待ち」案件を抽出
   ⭐ 新機能: 一覧画面でフィルタ・ソート可能
   ⭐ 改善: Excelを1件ずつ開く → システムで一覧表示
10. 案件を選択し「発注データ出力」ボタンをクリック
    ⭐ 新機能: CSV/Excelで仕入先別の発注データを自動生成
11. 出力データを販売システムにインポート
    ⭐ 改善: 手入力 → インポート
12. 発注書を仕入先に送付
13. システム上で「発注済」に一括更新
    ⭐ 新機能: チェックボックスで複数明細を一括処理
    ⭐ 改善: 発注日が自動記録される

[仕入先]
14. (変更なし)

[営業事務]
15. 商品入荷の都度、システム上で入力:
    ⭐ 新機能: システムのダッシュボードから直接入力可能
    ├─ 「入荷登録」画面を開く(案件を探す必要なし)
    ├─ 案件・明細を選択(検索・フィルタ機能)
    ├─ 入荷日を入力(デフォルト: 今日)
    └─ 出荷可能日を入力
    ⭐ 改善: Excelファイルを開く → システム画面で完結(数秒で完了)
    ⭐ 改善: 入力後、即座に全体の進捗状況に反映
```

#### フェーズ3: 月末計上処理(完全システム化)
```
[営業担当] ※ 月末25日頃〜
16. 「営業ダッシュボード」にアクセス
    ⭐ 新機能: 自分の案件を自動集計表示
    
    【表示内容】
    ┌─────────────────────────────┐
    │ 今月計上予定サマリー            │
    ├─────────────────────────────┤
    │ 計上確定済: 5件 / 12,500千円  │
    │ 申請中:     2件 / 3,200千円   │
    │ 申請可能:   3件 / 5,800千円   │ ← 緑色表示
    │ 明細未完了: 4件 / 8,100千円   │ ← 黄色表示
    └─────────────────────────────┘

17. 「申請可能」案件の詳細を確認
    - 全明細が入荷済・出荷可能日設定済を自動判定
    ⭐ 新機能: システムが自動で判定
17. 計上したい案件を選択し「計上申請」ボタンをクリック
    ⭐ 新機能: ボタン1つで申請完了(記録も残る)
    ⭐ 改善: 紙の指図書 → システム内での申請
19. 申請後、ステータスが「申請中」に変更
    ⭐ 新機能: リアルタイムで進捗確認可能

[営業事務]
20. 「月次計上申請一覧」画面にアクセス
    ⭐ 新機能: 全営業の申請案件を一覧表示
    ⭐ 改善: 指図書→Excel確認 → システム一覧で即座に確認
    
    【表示項目(自動集計)】
    - 申請日時、営業担当、案件名、顧客名
    - 売上金額、仕入金額、粗利、粗利率
    - 明細完了率(例: 5/5件 100%)
    - 最終入荷日、最短出荷可能日
    
21. 各案件をクリックして詳細確認
    ⭐ 新機能: 明細の入荷状況を自動表示
    ⭐ 改善: Excelファイルを開く必要なし
    - 全明細が緑色(完了)なら通常は承認
    - 黄色(未完了)があればその理由を確認
    - 都度更新されている入荷情報がリアルタイムで反映
    
22. 確認項目をチェック
    ⭐ 新機能: システムが自動判定した結果を表示
    ✓ 全明細入荷完了(システムが自動判定)
    ✓ 全明細に出荷可能日設定(システムが自動判定)
    □ 特記事項なし(手動確認)
    
23. 問題なければ「承認」ボタンをクリック
    - または複数案件を選択して「一括承認」
    ⭐ 改善: 一覧作成→営業回覧 → システム内で完結
    ⭐ 改善: 数字の転記作業がゼロ(システムが自動集計)
    
24. 問題があれば「差し戻し」ボタン + 理由入力
    - 営業担当に自動で通知メール送信
    ⭐ 新機能: 差し戻し理由が記録に残る

[営業担当]
25. システムから承認依頼通知を受信
26. 「営業ダッシュボード」で申請案件の数字を確認
    ⭐ 新機能: 印刷物回覧 → システム上で確認
    ⭐ 改善: リアルタイムで確認、その場で承認/差し戻し
27. 問題なければシステム上で承認
28. 問題があればコメントを付けて差し戻し

[営業事務] ※ 月末締め日
29. 「月次計上確定リスト」画面にアクセス
    ⭐ 新機能: 承認済み案件を自動集計
    ⭐ 改善: 手作業での一覧作成が不要(システムが自動生成)
    - フィルタ: 計上月=2025年11月、ステータス=承認済
    
30. 「販売システム連携用CSV出力」ボタンをクリック
    ⭐ 新機能: 必要データを自動でCSV生成
    ⭐ 改善: 一覧から手入力 → CSV自動出力(転記作業ゼロ)
    - 案件番号、顧客コード、明細、金額、計上月など
    
31. 販売管理システムにCSVインポート
    ⭐ 改善: 手入力(60-90分) → インポート(数秒)
    
32. 「ノーツ連携用CSV出力」ボタンをクリック
    ⭐ 新機能: ノーツ用データを自動生成
    ⭐ 改善: 同じ数字を再入力 → CSV自動出力
    
33. ノーツにCSVインポート
    ⭐ 改善: 手入力(30-60分) → インポート(数秒)
    
34. 出力したCSVとシステム画面を突合チェック
    ⭐ 改善: 3システムの突合(30分) → 自動整合性チェック(数秒)
    ⭐ 改善: 印刷物回覧 → 画面確認

[営業担当]
35. 「営業ダッシュボード」で計上確定状況を確認
    - 承認済み案件が「計上確定済」ステータスに変更
    ⭐ 新機能: 自動で通知、画面で確認可能
    ⭐ 改善: 印刷物回覧 → リアルタイム確認
36. 問題があればシステム上でコメント・差し戻し依頼
    ⭐ 新機能: システム内で完結
```

#### フェーズ4: 計上遅延・修正対応(システム管理)
```
[営業事務] ※ 翌月
33. 計上遅延が発生した案件:
    ├─ システム上で「計上月変更」機能を使用
    ├─ 変更理由を入力(必須)
    └─ 自動で履歴が記録される
    ⭐ 新機能: 変更履歴の自動記録・追跡可能

34. 「データ整合性チェック」機能を実行
    ⭐ 新機能: 見積システム⇔販売システム⇔ノーツの差異を自動検出
```

---

### 業務フロー比較: 作業時間削減効果

| 作業項目 | As-Is(現状) | To-Be(改善後) | 削減時間 |
|---------|------------|-------------|----------|
| **フェーズ2: 発注・入荷管理** | | | |
| 発注データ作成 | 30分/日 | 5分/日 | 25分/日 |
| 入荷管理入力(Excel開く→入力) | 20分/日 | 3分/日 | 17分/日 |
| 進捗確認(複数案件) | 30分/日 | 1分/日 | 29分/日 |
| **フェーズ3: 月末計上処理** | | | |
| 計上案件確認(営業) | 60分/月末 | 5分/月末 | 55分/月末 |
| Excel個別確認(事務) | 90分/月末 | 0分/月末 | 90分/月末 |
| 一覧作成・転記(1回目) | 60分/月末 | 0分/月末 | 60分/月末 |
| 営業回覧・確認 | 30分/月末 | 5分/月末 | 25分/月末 |
| 販売システム入力(2回目) | 90分/月末 | 5分/月末 | 85分/月末 |
| ノーツ入力(3回目) | 60分/月末 | 5分/月末 | 55分/月末 |
| 整合性チェック | 30分/月末 | 3分/月末 | 27分/月末 |
| **月間合計** | **約35-40時間** | **約3-4時間** | **約32-36時間(90%削減)** |

### 改善効果の内訳

#### データ転記回数の削減
| 項目 | 現状 | 改善後 |
|------|------|--------|
| 同じデータを扱う回数 | 4回(見積→一覧→販売→ノーツ) | 1回(見積システムのみ) |
| 人間による転記作業 | 3回 | 0回(自動出力) |
| 数字の確認・突合 | 各段階で実施 | 自動整合性チェック |

#### Excel操作回数の削減
| 操作 | 現状(月間) | 改善後(月間) |
|------|----------|------------|
| Excelファイルを開く | 200-300回 | 0回 |
| セル入力・更新 | 500-800回 | 0回 |
| データコピー&ペースト | 100-200回 | 0回 |

※ 営業事務の月末作業: **2-3日(16-24時間) → 2-3時間**に短縮
※ 日常の入荷管理作業: **1日70分 → 1日9分**に短縮